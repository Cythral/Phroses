var jQuery=$=require("jquery"),Phroses=require("phroses"),controller={};if(jQuery.fn.shake=function(e,s,t){e=void 0===e?100:e,s=void 0===s?10:s,t=void 0===t?3:t;var i=$(this);i.css("position","relative");for(var n=0;n<t+1;n++)i.animate({left:n%2==0?s:-1*s},e);return i.animate({left:0},e)},console.log("-== Phroses Initialized ==-"),controller=new Phroses,$(document).on("click",".jlink",function(){document.location=$(this).data("href")}),$("#phr-admin-page").val())Phroses.setupButtons(),Phroses.utils.formify({selector:"#phroses-login",success:function(){$("#phroses-login").animate({width:0},function(){location.reload()})},failure:function(){$("#phroses-login").shake()}}),Phroses.utils.formify({selector:".pageman-select",action:"change",collect:function(){return{type:$(this).val(),id:$(this).parent().parent().data("id"),nocontent:!0}},success:function(){var e=$(this).parent().parent();e.addClass("saved"),setTimeout(function(){e.removeClass("saved")},1e3)}}),$(".pageman-select").click(function(e){e.preventDefault(),e.stopImmediatePropagation()}),Phroses.utils.formify({selector:".pageman-delete",action:"click",collect:function(){return null},success:function(){$(this).parent().parent().slideUp(function(){$(this).remove()})}}),Phroses.utils.formify({selector:"#theme-selector",action:"change",collect:function(){return{theme:$(this).val()}},success:function(){Phroses.utils.displaySaved(),setTimeout(function(){location.reload()},2e3)}}),$("#phr-new-page").submit(function(e){document.location=$("#phr-new-page input").val()+"#new"}),Phroses.utils.formify({selector:"#phroses_site_creds",success:function(){Phroses.utils.displaySaved(),$("#phroses_site_creds input:not([name='username'])").val("")},failure:function(e){e=e.responseJSON,$("#error").html({username:"Please enter a value for the username field.",old:"The value for the old password was incorrect.",repeat:"The two new passwords do not match."}[e.field]||Phroses.errors[e.error]),$("#error").addClass("active"),setTimeout(function(){$("#error").removeClass("active")},5e3)}}),Phroses.utils.formify({selector:".admin-uri input",action:"change",collect:function(){return{uri:$(this).val()}},success:function(){Phroses.utils.displaySaved();var e=$(this).data("initial-value"),s=$(this).val();$(".adminlink").each(function(){$(this).attr("href",$(this).attr("href").replace(new RegExp("^"+e,"g"),s))}),history.replaceState({},document.title,$(this).val()),$(this).data("initial-value",$(this).val())},failure:function(e){$(this).val($(this).data("initial-value")),e=e.responseJSON,Phroses.utils.genericError(Phroses.errors.admin[e.error]||Phroses.errors[e.error])}}),Phroses.utils.formify({selector:".maintenance-select select",action:"change",collect:function(){return{maintenance:$(this).val()}},success:Phroses.utils.displaySaved}),Phroses.utils.formify({selector:".site-namer input",action:"change",collect:function(){return{name:$(this).val()}},success:Phroses.utils.displaySaved}),Phroses.utils.formify({selector:".admin-ip input",action:"change",collect:function(){return{adminip:$(this).val()}},success:Phroses.utils.displaySaved}),Phroses.utils.formify({selector:".siteurl-changer input",action:"change",collect:function(){return{url:$(this).val()}},success:function(){Phroses.utils.displaySaved();var e=$(this).val();setTimeout(function(){window.location.href="http://"+e+window.location.pathname},2e3)}});else{var content=$("body").html();$("body").html('<div id="phr-container">'+content+"</div>"),$.post(controller.adminuri+"/api/pst",{uri:window.location.pathname},function(e){$("body").append(e.content),Phroses.setupButtons();var s=new Phroses.editor;$("#pst-es-title").change(function(){$("#pst-es").submit()}),Phroses.utils.formify({selector:"#pst-ds",success:function(e){location.reload()}}),Phroses.utils.formify({selector:"#pst-ms",collect:function(){var e=$(this).serializeArray();return e.push({name:"id",value:$("#pid").val()}),e},success:function(e){history.replaceState({},document.title,$("#puri").val()),$("#pst-ms").fadeOut(),Phroses.utils.displaySaved()},failure:function(e){e=e.responseJSON,Phroses.genericError(Phroses.errors["pst-ms"][e.error]||Phroses.errors[e.error]||"An unknown error occurred.")}}),Phroses.utils.formify({selector:"#pst-ns",hash:"#new",hashreqclass:{element:"#pst",class:"new"},success:function(e){var t=$("#pst-ns [name=title]").val();$("#pid").val(e.id),$("#pst").removeClass("new"),$("#pst").addClass("existing"),$("#phr-container").html(e.content),$("#mode-content").html(e.typefields),$("#pst-es input[name=title]").val($("#pst-ns input[name=title]").val()),$("#pst-es-type").val($("#pst-ns select").val()),s.aceify(),document.title=t,$("#pst-ns").fadeOut(function(){$("#pst-ns")[0].reset()})}}),Phroses.utils.formify({selector:"#pst-vis input",action:"change",collect:function(){return{id:$("#pid").val(),public:!0===$(this).is(":checked")?1:0}},success:function(){}})})}